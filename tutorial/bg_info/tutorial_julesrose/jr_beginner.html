<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <meta name="description" content="JULES-Rose Tutorial" />
        <meta name="author" content="JULES System Manager" />
        <link rel="icon" href="jules_logo.png" />
        <title>JULES-Rose beginner</title>
        <!-- Bootstrap core CSS -->
        <link href="../etc/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
        <!-- Bootstrap theme -->
        <link href="../etc/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet" />
        <!-- Custom styles for this template -->
        <link href="general_theme.css" rel="stylesheet" />
     </head>
    <body>
        <!-- Fixed navbar -->
        <nav class="navbar navbar-inverse navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">JULES Beginner</a>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                        <!-- Add link to Homepage to training when created -->
                        <li class="active"><a href="#">Home</a></li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Beginner material <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li class="dropdown-header">Beginner Tutorials</li>
                                <li><a href="#bgj">Background of JULES</a></li>
                                <li><a href="#bgrc">Background of Rose (in fact Cylc)</a></li>
                                <li><a href="#bgmosrs">Background of MOSRS</a></li>
                                <li><a href="#subvc">Subversion</a></li>
                                <li><a href="#jrstem">JULES Rose stem</a></li>
                                <li><a href="#jrsuites">JULES Rose suites</a></li>
                                <li role="separator" class="divider"></li>
                                <li class="dropdown-header">Beginner Practical's</li>
                                <li><a href="#Pracs">Practicals</a></li>
                                <li><a href="#P1">Practical 1 - Background</a></li>
                                <li><a href="#P2">Practical 2 - Basic FCM</a></li>
                                <li><a href="#P3">Practical 3 - Checkout code</a></li>
                                <li><a href="#P4">Practical 4 -Checkout a suite </a></li>
                                <li><a href="#P5">Practical 5 - Change Ancillaries</a></li>
                                <li><a href="#P6">Practical 6 - Change Radiation Model and Plotting</a></li>
                            </ul>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Other material <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li class="dropdown-header">Quizzes</li>
                                <li><a href="beginner_quiz.html">Beginner Quiz</a></li>

                                <li><a href="intermediate_quiz.html">Intermediate Quiz</a></li>
                                <li><a href="advanced_quiz.html">Advanced Quiz</a></li>
                                <li role="separator" class="divider"></li>
                                <li class="dropdown-header">Tutorials and practical's</li>
                                <li><a href="jr_intermediate.html">Intermediate</a></li>
                                <li><a href="jr_advanced.html">Advanced</a></li>
                                <li role="separator" class="divider"></li>
                                <li class="dropdown-header">Help/info</li>
                                <li><a href="jr_glossary.html">Glossary List</a></li>
                                <li><a href="jr_links.html">Links</a></li>
                                <li><a href="jr_mqrg.html">My Quick Reference Guide</a></li>
                                <li><a href="jr_structures.html">JULES structures</a></li>
                                <li><a href="jr_rosecylc_setup.html">Rose/Cylc set-up</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <!--/.nav-collapse -->
            </div>
        </nav>
        <div class="container theme-showcase" role="main">
        <div class="jumbotron">
            <h1>JULES beginners background guide</h1>
            <p>This aims to explain the importance of:
            <ul>
                <li><a href="#bgj">Background of JULES</a></li>
                <li><a href="#bgrc">Background of Rose (in fact Cylc)</a></li>
                <li><a href="#bgmosrs">Background of MOSRS</a></li>
                <li><a href="#subvc">Subversion</a></li>
                <li><a href="#jrstem">JULES Rose stem</a></li>
                <li><a href="#jrsuites">JULES Rose suites</a></li>
            </ul>
            </p>
        </div>
        <div class="well">
            <ul>
                Pre-requisites
                <li>Have requested for access to JULES from the <a href="https://jules.jchmr.org/">jchmr website</a>.</li>
                <li>Have therefore got a Met Office Science Repository Service account and can access <a href="https://code.metoffice.gov.uk/trac/jules">JULES MOSRS webpages</a>.</li>
               <li>Have Rose, Cylc, FCM, keywords set up on the machine you are working on or are using the VM. <a href="https://github.com/metomi/metomi-vms">GitHub VM webpages</a> and the <a href="https://code.metoffice.gov.uk/trac/jules/wiki/JULESVirtualMachine">guidance</a> from the JULES MOSRS web pages.</li>
            <li>Completed the <a href="http://metomi.github.io/rose/doc/rose.html">Rose User Guide</a>.</li>

            </ul>
        </div>
      <div class="well">
      <h2>How to use the tutorial</h2>
      <p>
      This tutorial has been designed to be used as a teach yourself guide to
      JULES-Rose.
      </p>
      <p>
      Ideally the tutorial would be used in the following order:
      <ul>
      <li><a href="jr_beginners.html">Beginners tutorial and practicals</a>
      , pre-quiz section - this can be considered the starting point.</li>
      <li><a href="beginners_quiz.html">Beginners quiz</a> - a quiz to
      help you consider how you view your present understanding.</li>
      <li><a href="jr_beginners.html">Beginners tutorial and practicals</a>
      , post-quiz section - background, basic principles and some best working
       practices, introducing FCM, Rose, Cylc, rose-stem etc.</li>
      <li><a href="intermediate_quiz.html">Intermediate quiz</a> - introducing
      the concepts that you will be encountering in the Intermediate section.</li>
      <li><a href="jr_intermediate.html">Intermediate tutorial and practicals</a>
      - this section is intended to provide the intermediate users information
      on using JULES-Rose.</li>
      <li><a href="advanced_quiz.html">Advanced quiz</a> - introducing the
      concepts that you will be encountering in the Advanced section.</li>
      <li><a href="jr_advnaced.html">Advanced tutorial and practicals</a>
      this section is intended for advanced uses of JULES-Rose and covers
      higher level development of code and suites.</li>
      </ul>
      The design of the tutorial does mean that the user can just access the
      parts of the tutorial that they wish.
      </p>
      </div>
        <div class="well">
            First let's do the Beginner Quiz to see how much you already know and what we
            will need to focus on in this section, note there are no right or wrong answers
            for the first five questions.
        </div>
        <div class="container">
            <p><a class="btn btn-lg btn-success" href="beginner_quiz.html" role="button">Beginner Quiz</a></p>
        </div>
        <br/>
        <h1><a id="bgj">Background of JULES</a></h1>
        <p>
        <ul>
            <div class="page-header">
                <h2>What is JULES?</h2>
            </div>
            <div class="well">
               JULES is the Joint UK Land Environment Simulation model, it is a community Land Surface Model (LSM). 
               The model can be used as a standalone model.
               It is also part of the Met Office weather and climate prediction models where it is used in the couple between the land and the atmosphere as part of the Met Office Unified Model (UM).
            </div>
            <div class="page-header">
                <h2>Why use JULES?</h2>
            </div>
            <div class="well">
               JULES is used in the UK and worldwide for weather, climate and science research.
               JULES is used by meteorological services, universities, institutions and centres.
              JULES produces world class science and research.
              The code is hosted on the MOSRS which works with version control to provide a repository for all to access and browse.
             Version control allows for accountability, traceability and reproduceability.
             <p>Can you think of a scenario when you version control would be advantageous in your current job/activity? Describe it.</p>
             <p>Describe how you share work now with colleagues, could this be improved? How?</p>
            </div>
        </ul>
        <br/>
        <h1><a id="bgrc">Background of Rose (in fact Cylc)</a></h1>
        <p>
        <ul>
            <div class="page-header">
                <h2>What is Cylc?</h2>
            </div>
            <div class="well">
                Cylc is an intelligent workflow scheduling system that was created by Hilary Oliver at NWIA New Zealand.
                The <a href="https://cylc.github.io/cylc/documentation.html">documentation</a> describes it in more detail.
               In summary:
               "Cylc was developed for the EcoConnect Forecasting System at NIWA (National Institute of Water and Atmospheric Research, New Zealand)."
               "Environmental forecasting suites generate forecast products from a potentially large group of interdependent scientific models and associated data processing tasks."
               Cylc is now not just used for forecasting models but for scheduling tasks on computers by people all over the world.
               Monterey - US Naval Research Laboratory use it for scheduling tasks on there computer systems.
                This is growing collaboration with people around the world, at p
resent there are 17 contributors, 11 of which are not Met Office UK.
                The code is hosted on GitHub at <a href="https://github.com/cylc/cylc">cylc/cylc</a>.
            </div>
            <div class="page-header">
                <h2>What is Rose?</h2>
            </div>
            <div class="well">
                Rose is a wrapper to Cylc.
                It was developed when the Met Office saw the potential power of Cylc and that it could be made more user friendly but adding some additional functions around Cylc in the form of Rose.
                The Met Office wanted to work with NIWA to develop both Cylc and Rose for forecasting.
                This is growing collaboration with people around the world, at present there are 17 contributors, 4 of which are not Met Office UK.
                The code is hosted on GitHub at <a href="https://github.com/metomi/rose">metomi/rose</a>.
                The <a href="http://metomi.github.io/rose/doc/rose.html">Rose documentation</a> can be useful for background reading and a more detailed explanation for how the infrastructure works.
            </div>
            <div class="page-header">
                <h2>Why used Rose/Cylc?</h2>
            </div>
            <div class="well">
                Rose/Cylc provides a user friendly interface for JULES suites and allows them to be scheduled in the most efficient way using Cylc's clever algorithm (code).
                This means you just provide the order that you would like to run things in and it does the rest for you, submitting them once the dependencies have been meet.
                Rose/Cylc provides a user friendly interface for JULES code development with tests to check that your development has not broken someone else or some other code.
                Rose suites can be shared via the MOSRS using the "u-repository" and therefore you can choose an existing suite (bunch of tasks with the dependencies, inputs, outputs, all collected in one place) or adapt and existing suite for your own needs and run it to get your data.
               You can run bash, python, R, IDL scripts/tasks all as part of the suite, which means once it is set up you can run the suite and get on with a cuppa or some other work!
               Rose can retrieve data, archive data, remove data, plot data etc if you give it the correct tasks and tell it what the dependencies are.
               Rose means that you can run many suites with slightly different setting using the same base suite one straight after the other without having to wait for the first one to finish before running the next.
               Rose is meant to make your life easier so if it not try to figure out why and make it help.
               What work/activity/research that you are doing do you think you could use Rose/Cylc for?
            </div>
            <div class="page-header">
                <h2>Who uses Rose/Cylc?</h2>
            </div>
            <div class="well">
                Met Office, UK
                <br/>
                Bureau of Meteorology, Australia
                <br/>
                NIWA, NZ
                <br/>
                Indian Met Service
                <br/>
                Polish Met Service
                <br/>
                CSIRO, Australia
                <br/>
                ARC Centre of Excellence for Climate Systems Science, Australia
                <br/>
                SAWS, South Africa
                <br/>
                Korean Met Service, South Korea
                <br/>
                Singapore Met Service
                <br/>
                NCAS Computational Modelling Services, UK
                <br/>
                557th, American Air Force
                <br/>
                Exeter University, Astrophysics Dept. Exo-planets.
                <br/>
                ...the JULES community, on JASMIN, VM and at their location.
            </div>
            <div class="page-header">
                <h2>What are the advantages to using Rose/Cylc?</h2>
            </div>
            <div class="well">
                <ul>
                    <li>All the files are text files therefore you can search them using <code>grep</code></li>
                    <li>There are lots of Graphical User Interfaces (GUI's) to help make the user experience better and it easier to make changes and run suites.</li>
                    <li>Easy to add/remove/change: namelists, values etc</li>
                    <li>Can you think of any other things that it may or could be useful to have Rose make developing code and running suites (models/simulations) easier?
                </ul>
            </div>
        </ul>
        <br/>
        <h1><a id="bgmosrs">Background of MOSRS</a></h1>
        <p>
        <ul>
            <div class="page-header">
                <h2>Why was MOSRS set up?</h2>
            </div>
            <div class="well">
                To have a location for sharing repositories, Rose suites, information and collaborating on code.
            </div>
            <div class="page-header">
                <h2>Who uses MOSRS?</h2>
            </div>
            <div class="well">
                See the list above. 
            </div>
            <div class="page-header">
                <h2>Why should I use MOSRS?</h2>
            </div>
            <div class="well">
                The <a href="https://code.metoffice.gov.uk/trac/jules">JULES</a> pages are there to help you with your science.
                If something is missing report it to jules-support@metoffice.gov.uk and get it added.
                You can collaborate on the pages.
                You can look for support on the pages.
                Guidance, suggested Rose suites, Trac tickets, code release info and so much more are on the pages.
            </div>
        </ul>
        <br/>
        <h1><a id="subvc">Subversion</a></h1>
        <p>
        <ul>
            <div class="page-header">
                <h2>What is Subversion?</h2>
            </div>
            <div class="well">
                <h4>Key Features of Subversion:</h4>
                <li>It is an incremental change tracking system.</li>
                <li>We can explore the changes at each change and recall a version using its 
                    revision number.
                </li>
                <li>It takes snapshots of the directory tree vs time and records only the incremental changes.
                </li>
                <li>A working copy, which is in fact, a local copy of a particular version of 
                    the repository is available for users to freely work on.
                    Note managing the version control of the working copy and communicating 
                    changes is the responsibility of the user.
                </li>
                <li>Using copy-modify-merge allows each user of the repository to have their 
                    own personal working copy and they can work simultaneously and independently 
                    to modify their personal copies which can then be merged together later. 
                    Note it is the humans' responsibility to merge the files correctly and 
                    resolve any conflicts by manually.
                    This may mean choosing the correct file after discussions with any others 
                    editing the repository.
                </li>
                <li>Each change committed to the repository creates a new state of the 
                    filesystem tree (snapshot).
                    This is called a revision number.
                </li>
                <li>The revision number is applied to the entire repository tree and not 
                    individual files and is therefore also known as the Global Revision Number.
                    For example: at revision number N then a file may be the same as it was at 
                    revision number M but a <strong>different</strong> file was changed 
                    between the two revisions.
                </li>
            </div>
            <div class="page-header">
                <h2>Why use Subversion?</h2>
            </div>
            <div class="well">
                Any good version control system provides helpful tools to allow users to;   
                <ul>
                    <li>share work and encourage collaboration,</li>
                    <li>track the progression and incremental changes to versions/revisions of 
                        work,
                    </li>
                    <li>allow multiple flavours of the some work to investigate the impact of a 
                        change,
                    </li>
                    <li>traceability of work, for example what version of the work was used and
                        when,
                    </li>
                    <li>to revert a change,</li>
                    <li>branch from a version,</li>
                    <li>merge in changes</li>
                    <li>and so much more.</li>
                </ul>
            </div>
            <div class="page-header">
                <h2>How can I use Subversion?</h2>
            </div>
            <div class="well">
                There is a draft tutorial on the <a href="http://jules-lsm.github.io/tutorial/bg_info/tutorial/fcm_fundamentals.html">JULES GitHub</a> pages.
                When the offcial version is released it will be removed and this section will point to the offcial version.
                <li>It is recommended that you use <code>FCM</code>, which is a wrapper to Subversion, it has some additional user friendly functionality.</li>
            </div>
        </ul>
        <br/>
        <h1><a id="jrsuites">JULES Rose suites</a></h1>
        <p>
        <ul>
            <div class="page-header">
                <h2>What are JULES Rose suites?</h2>
            </div>
            <div class="well">
                These are suites created by the community for research and developing and testing new science.
                A selection of examples can be found on the <a href="https://code.metoffice.gov.uk/trac/jules/wiki/JULESWithRose#StandardRosesuites-Pleaseaddyourownheretohelpothers">JULESstandard suites</a> page and on the <a href="https://code.metoffice.gov.uk/trac/jules/wiki/ConfigurationsInfo#Configurations">JULES configurations</a> page.
            </div>
        </ul>
        <br/>
        <h1><a id="jrstem">JULES Rose stem</a></h1>
        <p>
        <ul>
            <div class="page-header">
                <h2>What is JULES Rose stem?</h2>
            </div>
            <div class="well">
                This is a testing system that checks to make sure that any code changes do not break any existing science that has a test.
                More tests are being added to provide robustness to the system.
                Rose stem is part of the JULES code and can be run by anyone that has a copy of the code.
            </div>
        </ul>
        <br/>
        <h1><a id="Pracs">Practicals</a></h1>
        <p>
        <ul>
            <div class="page-header">
                <h2><a id="P1">Practical 1 - Background</a></h2>
            </div>
            <div class="well">
            <h3>Practical 1 will cover:</h3>
            <p>Checking your set-up.</p>
            <br/>
            <p>Lets firstly check some set-up:</p>
            <pre>
            rosie hello
            # this should return something like this:
            <font color="blue">
            https://code.metoffice.gov.uk/rosie/u/hello: Hello kerryday
            </font>
            rose --version
            cylc --version
            fcm --version
            # these should return something like this:
            <font color="blue">
            Rose 2016.11.1 (/net/home/.../rose-2016.11.1)
            6.11.2
            FCM 2016.12.0 (/net/home/.../fcm-2016.12.0)
            </font>
            # hopefully they are the latest versions of the systems.
            fcm keyword-print
            # or short-hand: fcm kp
            # this should return all of the keywords that you and the site have set-up, a sample of mine are:
            <font color="blue">
            location{primary}[jules.x] = https://code.metoffice.gov.uk/svn/jules/main
            location{primary}[jules_doc.x] = https://code.metoffice.gov.uk/svn/jules/doc
            </font>
            </pre>
            <p>What are Keywords and why do we need them set-up?</p>
            <p>Keywords can be considered to be like short-hand or short-cuts to our full URL's.
            <br>
             Keywords can be defined in the FCM keyword configuration file (i.e. 
             <samp>$FCM/etc/fcm/keyword.cfg</samp> and 
             <samp>$HOME/.metomi/fcm/keyword.cfg</samp>).
             <br>
            For <strong>example</strong> in our <samp>.cfg</samp> file in our $HOME
            directory we can define a keyword as follows:
            <pre>        location{primary}[jules.x] = https://code.metoffice.gov.uk/svn/jules/main
            </pre>
            now we can abbreviate the URL as in the following examples:
            <pre>        # fcm ls https://code.metoffice.gov.uk/svn/jules/main
            fcm ls fcm:jules.x
            </pre>
            There are two main advantages for using URL keywords, what do you think they 
            could be?
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
            <div class="panel-heading">
            <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
            <span class="glyphicon"></span>
            Answers
            </a>
            </h4>
            </div>
            <div id="collapseOne" class="panel-collapse collapse">
            <div class="panel-body">
            <div class="row">
            <ol>
            <font color="green">
            <li>They are shorter and easier to remember.</li>
            <li>If the repository needs to be moved then only the keyword definitions need 
            to be updated (although any working copies you have will still need to be 
            relocated by issuing a <code>fcm switch --relocate</code> command).
            </li>
            </font>
            </ol>
            </div>
            </div>
            </div>
            </div>
            <br>


            </div>
        </ul>
        <br/>
        <ul>
            <div class="page-header">
                <h2><a id="P2">Practical 2 -Basic FCM</a></h2>
            </div>
            <div class="well">
            <h3>Practical 2 will cover:</h3>
            <p>Basic FCM commands that you will need for the tutorial and 
               version control.</p>
            <br/>
            <p>There are some very basic FCM commands that we need to know to work effectively.</p>
            <pre>
            fcm add
            fcm bc
            fcm bd
            fcm bls
            fcm cf
            fcm ci
            fcm co
            fcm info
            fcm merge
            fcm rm
            fcm revert
            fcm st
            fcm sw
            fcm up
            </pre>
            Do you know what any of them do?
            <br/>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseTwo" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
                            <font color=green>
fcm add - for adding a file or directory to the repository
fcm bc - for creating a branch, can also use 'fcm branch-create'
fcm bd - for deleting a branch, can also use 'fcm branch-delete'
fcm bls - for listing the branches associated with the repository, as default 
          this is only your branches, the '-a' option to list all other branches
          the '--user=kerryday' to list user kerryday's branches
fcm cf - for resolving text conflicts after a merge
fcm ci - for checking in a change to the repository
fcm co - for checking out a from the repository
fcm info - for getting info on the directory that you are working in
fcm merge - for merging in a branch
fcm rm - for removing a file or directory from the repository, option -c to 
         force it to remove the file from the repository even if it is missing
         from the directory
fcm revert - for reverting a file or directory which has not been 
             checked in/committed to the repository yet.
fcm st - for checking the status of the repository, VERY IMPORTANT, more later
fcm sw - for switching branches, don't often done for code but great for suites
fcm up - for updating the repository
                            </font>
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
            fcm <command> --help
            <br/>
            # will return the help to the screen, for example
            <br/>
            fcm add --help
            <br/>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree">
                        <span class="glyphicon"></span>
                        Answer
                        </a>
                    </h4>
                </div>
                <div id="collapseThree" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                           <pre>
                           <font color=green>
Usage:
        1. fcm add --check [PATH ...]

Options:
    --check, -c
        Check for any files or directories reported by "svn status" as not
        under version control and add them.

    For other options, see output of "svn help add".

add: Put files and directories under version control, scheduling
them for addition to repository.  They will be added in next commit.
usage: add PATH...

Valid options:
  --targets ARG            : pass contents of file ARG as additional args
  -N [--non-recursive]     : obsolete; try --depth=files or --depth=immediates
  --depth ARG              : limit operation by depth ARG ('empty', 'files',
                             'immediates', or 'infinity')
  -q [--quiet]             : print nothing, or only summary information
  --force                  : force operation to run
  --no-ignore              : disregard default and svn:ignore and
                             svn:global-ignores property ignores
  --auto-props             : enable automatic properties
  --no-auto-props          : disable automatic properties
  --parents                : add intermediate parents

Global options_
  --username ARG           : specify a username ARG
  --password ARG           : specify a password ARG
  --no-auth-cache          : do not cache authentication tokens
  --non-interactive        : do no interactive prompting (default is to prompt
                             only if standard input is a terminal device)
  --force-interactive      : do interactive prompting even if standard input
                             is not a terminal device
  --trust-server-cert      : accept SSL server certificates from unknown
                             certificate authorities without prompting (but only
                             with '--non-interactive')
  --config-dir ARG         : read user configuration files from directory ARG
  --config-option ARG      : set user configuration option in the format:
                                 FILE:SECTION:OPTION=[VALUE]
                             For example:
                                 servers:global:http-library=serf
                            </font>
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
            <p>More on fcm st</p>
            The command <code>fcm st</code> is a very powerful command and one which 
            should be used frequently to aid with our use of FCM.
            <br/>
            <code>fcm st</code> returns the status of the local/working copy files and 
            directories.
            <br/>
            <br/>
            Now we will look at the most common returned statuses including the meaning 
            of them and the implications on the repository.
            <br/>
            <br/>
            Information on the status of the file or directory is given in the first seven
            columns.
            <ol>
            <li><sup>st</sup> column - added/deleted/changed
            <br/>
            Below is the list of the statuses, what do you think they could mean?
            <pre>
            ' '
            'A'
            'C'
            'D'
            'I'
            'M'
            'R'
            'X'
            '?'
            '!' 
            '~'
            </pre>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
            <div class="panel-heading">
            <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseFour">
            <span class="glyphicon"></span>
            Answers
            </a>
            </h4>
            </div>
            <div id="collapseFour" class="panel-collapse collapse">
            <div class="panel-body">
            <div class="row">
            <ol>
            <pre>
            <font color="green">
            ' ' no modifications </font> - there have been no changes to the file or 
            directory when compared to the committed/checked-in repository version.
            <font color="green">
            'A' Added </font>- A file or directory has been add to the repository, 
            generally no action needs to be taken.
            <font color="green">
            'C' Conflicted </font>- There are conflicts. These must be resolved before the 
            changes can be committed to the repository. This is covered later.
            <font color="green">
            'D' Deleted </font>- A file or directory has been deleted from the repository, 
            generally no action needs to be taken.
            <font color="green">
            'I' Ignored </font>- This item is ignored by then repository, it has been 
            assigned the ignore flag, using the <font color="red">svn:ignore</font> property. 
            For Example: <font color="red">fcm propset svn:ignore "&lt;FILENAME&gt;" .</font> 
            <font color="green">
            'M' Modified </font>- A file or directory has been modified compared to the 
            committed/checked-in repository version.
            <font color="green">
            'R' Replaced </font>- A file or directory has been replaced in your working 
            copy. 
            This means the file was scheduled for deletion, and then a new file with the 
            same name was scheduled for addition in its place. 
            Replaced itemscan lead to complications. 
            <font color="green">
            'X' an unversioned directory created by an externals definition </font>- This 
            is a marker as with 'I'.
            <font color="green">
            '?' item is not under version control </font> - This may be an item that you 
            want to add to the repository. You do not have to, you may want to keep it
            outside of the repository because it is big or always changing. However, 
            remember that without adding it if the repository is checked out then the
            check out will not include this item.
            <font color="green">
            '!' item is missing (removed by non-svn command) or incomplete </font> - this
            item may have been deleted by a non-FCM command, you can solve this by using
            <samp>fcm rm -c &lt;FILE/DIRNAME&gt;</samp>
            <font color="green">
            '~' item is versioned as one kind of object (file, directory, link), but has 
            been replaced by a different kind of object. </font> - 
            </pre>
            </ol>
            </div>
            </div>
            </div>
            </div>
            </div>
            <p>For information on the other columns please refer to the <a href="http://jules-lsm.github.io/tutorial/bg_info/tutorial/fcm_essentials.html#st">FCM tutorial</a>.</p>
            <p>In the following practicals we will be using the FCM commands.</p>
            </div>
        </ul>
        <br/>
        <ul>
            <div class="page-header">
                <h2><a id="P3">Practical 3 - Checkout the code</a></h2>
            </div>
            <div class="well">
            <h3>Practical 3 will cover:</h3>
               <p>JULES rose-stem testing, for testing the JULES code.</p>
               <p>The gcylc GUI and helpful Rose and Cylc commands.</p>
               <p>Using the gcylc GUI, Rose Bush and the cylc-run directory.</p>
               <p>Using basic FCM commands.</p>
               <p>The basics of Trac pages and Tickets.</p>
               <p>Creating a branch and testing a basic change.</p>
            <br/>
            <p>We will now checkout the JULES code from the MOSRS repository.</p>
            <p>This will allow us to;</p>
                <ul>
                    <li>practice some FCM commands,</li>
                    <li>run the rose stem (the test suite/battery),</li>
                    <li>familiarise ourselves with some of the Rose and Cylc GUI's,</li>
                    <li>create branch from the trunk and make and test a basic change,</li>
                    <li>merge a different branch into your new branch,</li>
                    <li>Working Practices and Top Gotchas</li>
                </ul>
             <h3>Checkout the code</h3>
             <p>To checkout the trunk at the latest version/code release try the following:</p>
             <ol>
                 <li>Create a directory at <code>~/jules/</code></li>
                 <li>Checkout the trunk at vn4.7 (or the latest <a href="https://code.metoffice.gov.uk/trac/jules#ReleaseSchedule">release</a>)</li>
                 <p>We want to run the "rose-stem" suite now, but firstly what is the rose-stem suite and why do we want to run it?</p>
            <br/>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseSix">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseSix" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
                            <font color=green>
Rose-stem is a collection of tests in a suite.
It is used to test as much of the code and science as possible.
This means developers can prove that any change does not break other code and
or science and is bit compatible with the previous run checking Known Good
Output (KGO).
Rose-stem can test on different platforms and with different compliers.
Ideally all sites will have their own rose-stem tests that they run, preferably,
weekly.
                            </font>
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>

                <li>Change to the <code>~/jules/trunk/</code> directory and run all of the <code>rose stem</code> tests making sure that the suite is a "new" run using the command <code>rose stem --new --group=all</code>
<strong> if you do not have an HPC account please use --group=linux</strong> on the VM use --group=all</li>
            <br/>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseFive">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseFive" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
                            <font color=green>
# make the directory ~/jules/ and the path that may be required.
mkdir -p ~/jules/
# change to the directory ~/jules/
cd ~/jules
# checkout the JULES code at version vn4.7 using keywords
fcm co fcm:jules.x_tr@vn4.7
# or checkout the JULES code at version vn4.7 using the full URL
fcm co https://code.metoffice.gov.uk/svn/jules/main/trunk@vn4.7
# change to the directory ~/jules/trunk/
cd ~/jules/trunk/
# run all (or linux) of the rose stem tests (--group=all or linux) and make sure it is a new run (--new)
rose stem --new --group=all -- --hold
                            </font>
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
            <p>This should produce some output like this</p>
            <br/>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseSeven">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseSeven" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
                            <font color=blue>
&gt; rose stem --group=all --new
[INFO] Source tree /net/home/.../jules/trunk added as branch
[INFO] chdir: /net/home/.../jules/trunk/rose-stem/
[INFO] Will run suite from /net/home/.../jules/trunk/rose-stem
[INFO] delete: /home/.../cylc-run/trunk/log/rose-suite-run.host
[INFO] delete: /net/home/.../cylc-run/trunk/
[INFO] delete: /data/.../cylc-run/trunk/share/
[INFO] delete: /data/.../cylc-run/trunk/work/
[INFO] create: /home/.../cylc-run/trunk
[INFO] create: log.20161212T145319Z
[INFO] symlink: log.20161212T145319Z &lt;= log
[INFO] create: log/suite
[INFO] create: log/rose-conf
[INFO] symlink: rose-conf/20161212T145319-run.conf &lt;= log/rose-suite-run.conf
[INFO] symlink: rose-conf/20161212T145319-run.version &lt;= log/rose-suite-run.version
[INFO] create: /net/data/.../cylc-run/trunk/share
[INFO] symlink: /net/data/.../cylc-run/trunk/share &lt;= share
[INFO] create: /net/data/.../cylc-run/trunk/share/data
[INFO] symlink: data &lt;= share/cycle
[INFO] create: /net/data/.../cylc-run/trunk/work
[INFO] symlink: /net/data/.../cylc-run/trunk/work &lt;= work
[INFO] export CYLC_VERSION=6.11.2
[INFO] export ROSE_ORIG_HOST=eld661
[INFO] export ROSE_VERSION=2016.11.1
[INFO] create: meta
[INFO] install: meta
[INFO]     source: /net/home/.../jules/trunk/rose-stem/meta
[INFO] create: bin
[INFO] install: bin
[INFO]     source: /net/home/.../jules/trunk/rose-stem/bin
[INFO] create: include
[INFO] install: include
[INFO]     source: /net/home/.../jules/trunk/rose-stem/include
[INFO] create: app
[INFO] install: app
[INFO]     source: /net/home/.../jules/trunk/rose-stem/app
[INFO] install: suite.rc
[INFO] 0 suite(s) unregistered.
[INFO] REGISTER trunk: /home/.../cylc-run/trunk
[INFO] symlink: /home/.../cylc-run/trunk &lt;= /home/.../.cylc/trunk
[INFO] WARNING: deprecated items were automatically upgraded in 'suite definition':
[INFO]  * (6.11.0) [cylc][event hooks][shutdown handler] -&gt; [cylc][events][shutdown handler] - value unchanged
[INFO]  * (6.11.0) [cylc][event hooks] - value unchanged
[INFO]  * (6.11.0) [runtime][root][event hooks][submission timeout handler] -&gt; [runtime][root][events][submission timeout handler] - value unchanged
[INFO]  * (6.11.0) [runtime][root][event hooks][submission timeout handler] -&gt; [runtime][root][events][submission timeout handler] - value unchanged
[INFO]  * (6.11.0) [runtime][root][event hooks][retry handler] -&gt; [runtime][root][events][retry handler] - value unchanged
[INFO]  * (6.11.0) [runtime][root][event hooks][execution timeout] -&gt; [runtime][root][events][execution timeout] - value unchanged
[INFO]  * (6.11.0) [runtime][root][event hooks][submission timeout] -&gt; [runtime][root][events][submission timeout] - value unchanged
[INFO]  * (6.11.0) [runtime][root][event hooks][execution timeout handler] -&gt; [runtime][root][events][execution timeout handler] - value unchanged
[INFO]  * (6.11.0) [runtime][root][event hooks][submission failed handler] -&gt; [runtime][root][events][submission failed handler] - value unchanged
[INFO]  * (6.11.0) [runtime][root][event hooks][succeeded handler] -&gt; [runtime][root][events][succeeded handler] - value unchanged
[INFO]  * (6.11.0) [runtime][root][event hooks][failed handler] -&gt; [runtime][root][events][failed handler] - value unchanged
[INFO]  * (6.11.0) [runtime][LINUX][job submission][method] -&gt; [runtime][LINUX][job][batch system] - value unchanged
[INFO]  * (6.11.0) [runtime][METO_LINUX_COMPUTE][job submission][method] -&gt; [runtime][METO_LINUX_COMPUTE][job][batch system] - value unchanged
[INFO]  * (6.11.0) [runtime][METO_LINUX_NETCDF_COMPARISON][job submission][method] -&gt; [runtime][METO_LINUX_NETCDF_COMPARISON][job][batch system] - value unchanged
[INFO]  * (6.11.0) [runtime][METO_XC40][job submission][method] -&gt; [runtime][METO_XC40][job][batch system] - value unchanged
[INFO] 2016-12-12T14:53:24Z WARNING - task "fcm_make_meto_linux_intel_omp_nompi" not used in the graph.
[INFO] 2016-12-12T14:53:24Z WARNING - task "METO_XC40_CORES_8" not used in the graph.
[INFO] 2016-12-12T14:53:24Z WARNING - task "METO_XC40_OMPTHREADS_8" not used in the graph.
[INFO] chdir: log/
[INFO] trunk: will run on xxxcylcxx
[INFO]             ,_,                                                       
[INFO]             | |                The Cylc Suite Engine [6.11.2]         
[INFO] ,_____,_, ,_| |_____,           Copyright (C) 2008-2016 NIWA          
[INFO] | ,___| | | | | ,___|  _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
[INFO] | |___| |_| | | |___,  This program comes with ABSOLUTELY NO WARRANTY;
[INFO] \_____\___, |_\_____|  see `cylc warranty`.  It is free software, you 
[INFO]       ,___| |           are welcome to redistribute it under certain  
[INFO]       \_____|                conditions; see `cylc conditions`.
[INFO] 
[INFO] Suite Info:
[INFO]  + Name: trunk
[INFO]  + PID: 31775
[INFO]  + Host: xxxcylcxx.metoffice.gov.uk
[INFO]  + Port: XXXX
[INFO]  + Logs: /home/.../cylc-run/trunk/log/suite/{log,out,err}
[INFO] 
[INFO] To see if 'trunk' is running on 'xxxcylcxx.metoffice.gov.uk:XXXX':
[INFO]  * cylc scan -n '\btrunk\b' xxxcylcxx.metoffice.gov.uk
[INFO]  * cylc ping -v --host=xxxcylcxx.metoffice.gov.uk trunk
[INFO]  * ssh xxxcylcxx.metoffice.gov.uk "pgrep -a -P 1 -fu $USER 'cylc-r.* \btrunk\b'"
[INFO] 
                            </font>
Note that the "WARNINGS", are just warnings and will not cause problems with 
running the tests.
Your output will look different as it will have the paths complete and may or
may not have so many locations to delete any previous run's data from.
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
           Now lets explore the GUI's.
           <h3>The cylc gcylc GUI</h3>
           <p>The gcylc GUI should have opened up on your screen as a result 
              of running the last command.</p>
           <p>Using the option <code>-- --hold</code> tells Cylc to start the 
              suite in the <strong>held</strong> state so we can investigate 
              the gcylc GUI functionality.</p>
           <p>It is the suite specific Graphical User Interface for monitoring 
              the progress of your specific suite.</p>
           <p>Note you can have multiple unique gcylc's open for different 
              suites.</p>
           <p>Your rose-stem gcylc GUI should look like this:</p>
           <img src="images/gcylc_hold.png" width="60%" id="cghold"/>
           <br/>
           <p>We will discuss the gcylc GUI before we release (play/run) the 
              suite.<p>
           <p>Lets look at an image of a running gcylc GUI and try to 
              understand the different aspects of it.</p>
           <img src="images/rose_stem_gcylc.png" width="90%" id="rsg"/>
           <h4>Key points from the gcylc GUI</h4>
           <ol>
           <li>The square coloured blocks - theses are the current states of the tasks
           <br/><img src="images/task_filtering.png" width="35%" id="tf"/></li>
           <li>The "F" inside the square blocks - this denotes that it is a 
           family of tasks</li>
           <li>Here the Family GSWP2 and METO_LINUX_GFORTRAN_GSWP2 are expanded
           using the arrows beside them and we can see that all eight members 
           of the family are in a waiting state and the full names of the task.</li>
           <li>When a task has run you can look at its standard output via the 
           GUI by right clicking on the task name.
           For example, fcm_make_meto_xc40_cce-omp:
           <br/><img src="images/gcylc_investigate.png" width="90%" id="cg_invest"/>
           <br/>Then you can look at the standard out, err and interact with
           the task.</li>
           <li>We can pause or stop the suite using the buttons at the top left
           of the gcylc GUI or by selecting the <code>Control</code> tab
           <br/><img src="images/stop_suite.png" width="90%" id="ss"/>
           <br/><img src="images/stop_suite_daemon.png" width="35%" id="ssd"/>
           <br/>Note in the last image in the top taskbar it says:
           <code>Stop Suite Daemon vn4p7</code> this means that this panel 
           can be used to stop the suite at the location it is running using 
           the suite daemon.
           Which is the computer program that runs as a background process.</li>
           There are many other functions that we will learn about through the
           tutorial but these are the basics.
           </ol>
            <br/>
            Questions the on gcylc GUI
            <ol>
            <li>How can you find the error of a task?</li>
            <li>In the image above in 5. what is the state of the 
            fcm_make_meto_xce40_cce_debug task, what two ways do you know from
            the GUI?</li>
            <li>In the image above in 5. what is the state of the 
            METO_LINUX_BUILD family?</li>
            <li>In the image above in 5. what is the state of the
            KGO_CHECK family?</li>
            <li>What does KGO stand for? (Answer is not in the GUI.)</li>
            <li>What two ways could you pause a suite?</li>
            <li>Why do you think that you may want to kill a suite and how 
            would you do so?</li>
            </ol>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseEight">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseEight" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
<ol>
<li>How can you find the error of a task?</li>
<font color=green>
Right click on the task, select 'View', select 'job stderr'.
</font>
<li>In the image above in 5. what is the state of the 
fcm_make_meto_xce40_cce_debug task, what two ways do you know from the GUI?</li>
<font color=green>
succeeded, it is a grey square and the 'state' column say 'succeeded'.
</font>
<li>In the image above in 5. what is the state of the METO_LINUX_BUILD family?</li>
<font color=green>
running
</font>
<li>In the image above in 5. what is the state of the KGO_CHECK family?</li>
<font color=green>
waiting
</font>
<li>What does KGO stand for? (Answer is not in the GUI.)</li>
<font color=green>
Known Good Output
</font>
<li>What two ways could you pause a suite?</li>
<font color=green>
Pause button on the top left or 'Control' and select 'Hold Suite (pause)'
</font>
<li>Why do you think that you may want to kill a suite and how would you do so?</li>
<font color=green>
There are mainly reasons, for example it failed and you need to fix the error.
'Control' tab, select 'Stop Suite', select 'Stop after killing active tasks'
</font>
</ol>
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>

            <h4>What if you do not have access to a GUI?</h4>
            <p>There is a command line equivalent, it is not as elegant: </p>
            <code>cylc scan -c</code>
            <p>It should produce something like this:</p>
            <br/><img src="images/cylc_scan_c.png" id="csc"/>
            <br/>
            <h4>What if you accidently close the gcylc GUI?</h4>
            <p>You can reopen it using:</p>
            <code>cylc gui vn4p7 #where vn4p7 is the suite id</code>
            <br/>OR
            <p>You can use the cylc gscan GUI</p>
            <code>cylc gscan &amp; #&amp; background the task so you can still use your terminal</code>
            <br/>
            <br/><img src="images/cylc_gscan.png" id="cgscan"/>
            <br/>
            <p>Now you can double click on the suite id of the suite that you
            want to open and the gcylc GUI of that will appear.</p>
            <br/>OR
            <p>You can use Rose to open the gcylc GUI</p>
            <code>rose suite-gcontrol --name=SUITE-NAME</code> Or the shorthand
            <code> rose sgc --name=SUITE-NAME</code>
            <br/>
            <h4>How else could we look at the output from the suite?</h4>
            <p>We already know that we can use the gcylc GUI to look at the 
               job stderr/out by <strong>right click</strong> on a task and
               select <strong>View</strong> and then the job stderr.
               We may also want to look at the log file for the suite.</p>
            <p>This can be viewed in via the gcylc GUI if there are errors.
               If there are errors then a orange warning triangle will appear
               in the bottom right hand corner of the screen.</p>
            <img src="images/warning_tri.png" id="warning"/>
            <p>Double clicking on it will open up an information box with any
               errors from the log of the suite.</p>
            <br/>
            <h4>Other ways of looking at information from the suite:</h4>
            <p>We can, if it is set-up look at the information in a web 
               browser.</p>
            <p>This is known as <strong>rose bush</strong>.</p>
            <p>At the Met Office the top level page looks like the image
               below.</p>
            <img src="images/rose_bush1.png" width="85%" id="rb1"/>
            <br/>
            <br/>
            <p>At the Met Office the second level page looks like the image
               below.
               This was reached by completing the "User Id" and selecting the
               "Suite List" button.
               This then provides a list of the owners suites that they have 
               run and or are running.</p>
            <img src="images/rose_bush2.png" width="65%" id="rb2"/>
            <br/>
            <br/>
            <p>At the Met Office the suite level page looks like the image
               below.
               The suite was selected by clicking on the "task jobs list" 
               associated with the desired suite name.</p>
            <img src="images/rose_bush3.png" width="85%" id="rb3"/>
            <br/>
            <br/>
            <p>On the VM the suite level page looks like the image below.</p>
            <img src="images/vm_rose_bush.png" width="85%"id="vmrb"/>
            <br/>
            <br/>
            <p>The last two images are equivalent run on two different
               sites/systems.</p>
            <br/>
            <p>Depending on your site set-up there are different ways of 
               accessing rose bush.
               As can be seen in the above two images.
               In an internet window if you know the path you can use that.</p>
            <p>At command line rose bush can be invoked for a suite that you 
               have run or is running from within the directory of the 
               suite.</p>
            <p><code>rose slv</code> or <code>rose suite-log --view</code> you
               can also add the option of the <code>--name=SUITE_NAME</code>
           <br/>
           <h4>More on Rose Bush</h4>
            <br/>
            <p>The location of the log for the suite err and out which can be 
            very helpful when debugging a suite.</p>
            <img src="images/rose_bush4.png" width="85%" id="rb4"/>
            <br/>
            <br/>
            <p>The location of the log for the Rose and other files, this can 
            be helpful.</p>
            <img src="images/rose_bush5.png" width="85%" id="rb5"/>
            <br/>
            <br/>
            <p>Using the "Display Options" button to search for tasks by...
            <br/>
            ...name (using the Task Name Glob) which means you can search for 
            part of a name, for example <code>*linux*</code>
            <br/>
            ...specifying the number of Entries/Page is helpful for both very 
            large suites, especially when combined with other options
            <br/>
            ...the Sort Order drop down is a useful option for example looking
            at the first failed task
            <br/>
            ...you can combine options
            <br/>
            ...remember to use the "update" button to apply your requested
             Display Options.
            </p>
            <img src="images/rose_bush7.png" width="85%" id="rb7"/>
            <br/>
            <br/>
            <p>The "Display Options" also includes a very useful function of
               being able to look at jobs via their task status.</p> 
            <p>This can be done by selecting the Job Status drop down box.</p>
            <p>You can then search by the status of the task.</p>
            <p>For example searching for all Failed tasks is often very helpful.
            </p>
            <img src="images/rose_bush8.png" width="85%" id="rb8"/>
            <br/>
            <br/>
            <p>Cycles List</p>
            <p>The Cycles List tab at the top is useful for looking at the
               suite dependant on its cycle.</p>
            <p>As you can see below this functionality is not that useful for
               rose stem suites.</p>
            <img src="images/rose_bush6.png" width="85%" id="rb6"/>
            <br/>
            <br/>
            <h4>The cylc-run directory</h4>
            <p>A third place that we can look at the logs for a suite is
               in the <code>cylc-run</code> directory.</p>
            <p>This directory is created by Cylc at the time that the run is 
               started, it is populated by Cylc.</p>
            <p>The cylc-run directory is the location where the information, 
               logs and data are sent to.</p>
            <p>The directory structure often looks like this:</p>
            <pre>
app                    include               suite.rc
bin                    log                   suite.rc.processed
cylc-suite-env         log.20161223T075541Z  trac.log
cylc-suite-private.db  meta                  work
cylc-suite-public.db   passphrase
cylc-suite.db          share
           </pre>
           <p>The <code>log*/</code> directories are where all of the logs are 
              located.</p>
           <p>The <code>log/suite/</code> is where the suite logs are found.</p>
           <p>The <code>log/job/1/</code> is where the logs for each task is
              found.
              This includes the <code>job stderr, job stdout</code>.</p>
           <p>The <code>work/1/</code> directory is where the output for each
              task is, but note if <code>HOUSEKEEPING</code> is run then these
              may be deleted (housekept).</p>
           <p>The <code>share/</code> directory is where any shared data or
              cycle specific data is stored.</p>
           <p>Note rose-stem is not a cycling suite so there is only 
              <code>1</code> cycle, which is also why the directories above 
              have a <code>1</code> in there path.</p>
           <p>The <code>trac.log</code> is only produced for rose-stem suites.
           </p>
           <p>The <code>trac.log</code> is created once the suite has stopped
              and is required for code development evidence in the
              TicketSummary, more on this later.</p>
           <p>The <code>app</code>, <code>bin</code>, <code>suite.rc</code>,
              <code>include</code> and <code>meta</code> are all the same as 
              are be found in the <code>rose-stem/</code> directory.</p>
           <p>The <code>suite.rc.processed</code> is the suite.rc but with any
              <code>Jinja2</code>, explained later, expanded fully, with all
              variables and loops expanded.</p>
           <p>The <code>cylc-suite*</code> files are database files for Rose
              Bush etc.</p>
           <p>The <code>passphase</code> is a communications level file.</p>
           <br/> 
            <h3> Test your understanding</h3>
            <br/><img src="images/warning_tri.png" id="warning"/>
            <p>Explain the following from the image above (moving left to right):</p>
            <ol>
            <li>What does the filled gray square represent?</li>
            <li>What does the hollow purple square represent?</li>
            <li>What does the hollow blue square represent?</li>
            <li>What does the filled green square represent?</li>
            <li>What does the filled red square represent?</li>
            <li>What date was the suite last active, from the image.</li>
            <li>What information would double clicking on the warning triangle provide?</li>
            <li>What information would you get by hovering over a coloured square?</li>

            </ol>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseNine">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseNine" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
            <ol>
            <li>What does the filled grey square represent?</li>
            <font color=green>Succeeded tasks.</font>
            <li>What does the hollow purple square represent?</li>
            <font color=green>Filtered tasks.</font>
            <li>What does the hollow blue square represent?</li>
            <font color=green>Waiting tasks.</font>
            <li>What does the filled green square represent?</li>
            <font color=green>Running tasks.</font>
            <li>What does the filled red square represent?</li>
            <font color=green>Failed tasks.</font>
            <li>What date was the suite last active, from the image.</li>
            <font color=green>2016-05-20 at 14 hrs, 13 mins and 20 seconds in GMT+1 (BST).</font>
            <li>What information would double clicking on the warning triangle provide?</li>
            <font color=green>err log for the log of the suite.</font>
            <li>What information would you get by hovering over a coloured square?</li>
            <font color=green>How many of each tasks for each state there is.</font>
            </ol>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
            <p>General questions on gcylc, rose bush etc.</p>
            <ol>
                <li>What three ways can you find the job stderr for a task?</li>
                <li>In the gcylc GUI what does a <code>F</code> inside a 
                    coloured square mean?</li>
                <li>What two things in the gcylc GUI inform you of the state of
                    a task? </li>
                <li>How could you Stop a suite (all three ways)?</li>
                <li>How could you open a closed gcylc GUI (both ways)?</li>
                <li>How could you open Rose Bush from command line?</li>
                <li>In Rose Bush how can you see only the Failed tasks?</li>

            </ol>   
        <br/>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseTen">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseTen" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
            <ol>
<li>What three ways can you find the job stderr for a task?</li>
<font color=green>In the gcylc GUI by right clicking on the task, select View, select job stderr.
In Rose Bush.
In the cylc-run/&lt;SUITE_NAME&gt;/log/job/1/&lt;TASK_NAME&gt;/NN  directory.</font>
<li>In the gcylc GUI what does a <code>F</code> inside a
coloured square mean?</li>
<font color=green>It is a family of tasks.</font>
<li>What two things in the gcylc GUI inform you of the state of
a task? </li>
<font color=green>The colour of the square.
The state column.</font>
<li>How could you Stop a suite (all three ways)?</li>
<font color=green>Stop button at the top left.
Right click a task and Stop (but this would only stop that task).
Select Control and then Stop.</font>
<li>How could you open a closed gcylc GUI (both ways)?</li>
<font color=green>cylc gscan and then double click on the desired suite id.
rose sgc --name=SUITE_ID</font>
<li>How could you open Rose Bush from command line?</li>
<font color=green>rose slv</font>
<li>In Rose Bush how can you see only the Failed tasks?</li>
<font color=green>Display Options, Select by Job Status, failed.</font>
 </ol>
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
            <h3>Tasks</h3>
            <ol>
            <li>
            <p>Now we know some of the more regularly used functionality of the
               gcylc GUI we should let our rose stem suite run.</p>
            <p>Release the suite using the <code>Play</code> button on the top
               left of the gcylc GUI.</p>
            <p>Have a look around the gcylc GUI and find some of the functions
               discussed above, but <strong>DO NOT Stop</strong> the suite as 
               we want to prove that the JULES trunk code is successful!</p>
            </li>
            <li>
            <p>Bring up <code>Rose Bush</code> and have a look around, note 
               you can access Rose Bush while the suite is running.</p>
            </li>
            </ol>
            <h3>Tickets</h3>
            <p>A brief description and discussion on tickets</p>
            <br/>
            <p>Even if you never have any intention of making a ticket which 
               you hope resolve tickets can be used to highlight bugs, when 
               something has been broken, or areas of development.
               Therefore it is helpful to understand them, their uses, how to
               create a ticket and or just keep any eye on tickets that may
               be of interest to the science that you are working on.</p>
            <br/>
            <p>JULES code is part of the MOSRS, as part of the system there is
               a Trac system.
            <h4>Trac</h4>
            <p>Trac is a wiki system which we can use for organizing knowledge
               and information in a way that FCM can interact with.</p>
            <p>A brief summary on Trac:</p>
            <ul>
            <li>It is a flexible issue tracker.</li>
            <li>It provides a roadmap feature for managing project release,
                including a record of all changes included in the release.</li>
            <li>It has a built-in wiki.</li>
            <li>It lets us use a browser for viewing the repositories, where
                we can browse the code and files, examine revision logs and 
                changesets.</li>
           <li>It provides a timeline view with summaries of changes to.</li>
           <li>It provides a flexible ticket workflow, supporting the
               review process.</li>
           </ul>
           <h4>Trac Tickets</h4>
           <p>From the JULES MOSRS <a href="https://code.metoffice.gov.uk/trac/jules">homepage</a>
              select <code>View Tickets</code> if you are the <code>Owner</code>
              of any tickets this will bring them up for you to see.</p>
             <img src="images/trac_wiki.png" width="95%" id="trac"/>
             <br/>
             <p>Some important points from this page</p>
             <ol>
                 <li>RSS Feeds - you can sign up for RSS feeds to receive feeds
                     on a ticket or a owner</li>
                 <li>You can add and remove Filters, try removing the Owner and 
                     adding a Milestone</li>
                 <li>You can add and remove Columns, try adding Owner and 
                     remove Priority
                 </li>
                 <p>Click the Update button so see your selection, it should
                    look similar to the image below:</p>
                 <img src="images/trac_wiki2.png" width="95%" id="trac2"/>
            </ol>
           <br/>
            <p>To create a New Ticket, select the New Ticket button at the top 
               right of the page and fill in the details.
               The Description will need a link to the branch before it is
               passed for review.
               For example <code>[log:main/dev/kerryday/vn4.7_new_tests vn4.7_new_tests]</code>
               and a Ticket Summary page <code>[wiki:ticket/###/TicketSummary ticket summary]</code>
              These make it easier for the reviewer.</p>
              <p>If you are only reporting a bug then please fill in as much as
                 possible with evidence and try to find a suitable person to
                 do the work if you are not able and Cc the JULES System Manger.
              </p>

            <h3>Creating a branch and testing the new code in it</h3>
            <p>Please refer to the <a href="https://code.metoffice.gov.uk/trac/jules/wiki/WorkingPractices">Working Practices for JULES development</a>.
            <br/>
            <p>Here we will make a basic change to the JULES code and test it
               with the rose stem test battery of tests.</p>
            <p>We know that the JULES code passes all the tests from running it
               earlier, we will make a branch for your change and see if the 
               branch change does not create failures.</p>
           <h4>Creating a Branch</h4>
           <p>Creating a branch from the latest code release of JULES:</p>
           <p><code>cd ~jules</code>
           <p><code>fcm bc tutorial_bc_rosestem fcm:jules.x_tr@vn4.7</code>
           <br/>please insert the most recent version number.
           <br/><code>bc</code> - means <code>branch-create</code>
           <br/>"tutorial_bc_rosestem" will be the name of the branch.</p>
           <p>If you do not have keywords set-up you will have to use the URL:
           <code>fcm bc tutorial_bc_rosestem https://code.metoffice.gov.uk/svn/jules/main/trunk@vn4.7</code></p> 
           <p>This will bring up a text editor window for you to add your
              commit message about the branch.</p>
           <p>If you do not have text editor as default or wish to change the
              default you can use, for example:
              <code>export SVN_EDITOR=vim</code></p>
           <p>The editor window should look like this:
           <pre>

--Add your commit message ABOVE - do not alter this line or those below--
--FCM message (will be inserted automatically)--
Created /main/branches/dev/kerryday/vn4.7_tutorial_bc_rosestem from /main/trunk@5320.
--Change summary (not part of commit message)--
A    https://code.metoffice.gov.uk/svn/jules/main/branches/dev/kerryday/vn4.7_tutorial_bc_rosestem
</pre>
           Add a comment to the top of it and then close, save it and accept
           the change.
           </p>
           <p>This should return text like the following:</p>
           <pre>
<font color=blue>
[info] Source: https://code.metoffice.gov.uk/svn/jules/main/trunk@5320 (5320)
[info] vim: starting commit message editor...
Change summary:
--------------------------------------------------------------------------------
A    https://code.metoffice.gov.uk/svn/jules/main/branches/dev/kerryday/vn4.7_tutorial_bc_rosestem
--------------------------------------------------------------------------------
Commit message is as follows:
--------------------------------------------------------------------------------
Created /main/branches/dev/kerryday/vn4.7_tutorial_bc_rosestem from /main/trunk@5320.
--------------------------------------------------------------------------------
Create the branch?
Enter "y" or "n" (or just press &lt;return&gt; for "n") y
Committed revision ####.
[info] Created: https://code.metoffice.gov.uk/svn/jules/main/branches/dev/kerryday/vn4.7_tutorial_bc_rosestem
</font>
           </pre>
           <h4>Working on the Branch</h4>
           <p>There are two different ways of working on a branch, for code
              development I use the first and for suite development I use the
              second. Both have different merits and are given below.</p>
          <ol>
          <li>Check out a copy to a new directory.
             <br/>
             <p>For example: <code>fcm co fcm:jules.x_br/dev/USERNAME/BRANCH_NAME</code> and then move to that directory.</li>
          <li>Switch to the branch from within the directory of trunk@vn4.7.
             <br/>
             <p>For example: <code>fcm sw fcm:jules.x_br/dev/USERNAME/BRANCH_NAME</code>.</li>
          </ol>
          <p>Here we will use the first method (later we will use the second).</p>
          <br/>
          <pre>
cd ~jules/
fcm co fcm:jules.x_br/dev/USERNAME/vn4.7_tutorial_bc_rosestem
cd vn4.7_tutorial_bc_rosestem
</pre>
           <p>HELPFUL HINT: if you forget your branch name you can list them using:</p>
          <pre>
fcm bls
</pre>
          <p>Now check the information for the directory of the repository that
             you are presently in (very helpful when using switch) and the 
             status</p>
<pre>
fcm info
<font color=blue>
Path: .
Working Copy Root Path: /USER/jules/vn4.7_tutorial_bc_rosestem
URL: https://code.metoffice.gov.uk/svn/jules/main/branches/dev/USERNAME/vn4.7_tutorial_bc_rosestem
Relative URL: ^/main/branches/dev/USERNAME/vn4.7_tutorial_bc_rosestem
Repository Root: https://code.metoffice.gov.uk/svn/jules
Repository UUID: ac5b6c67-d81e-4bef-bedc-f37a4dd2bd0a
Revision: 1222
Node Kind: directory
Schedule: normal
Last Changed Author: USERNAME
Last Changed Rev: 1234
Last Changed Date: 2030-12-01 09:21:40 +0000 (Mon, 01 Dec 2030)

</font>
fcm st

# returns nothing as there are no local/working copy changes in the directory.
</pre>
            <br/>
            <p>Make a basic change to the branch:</p>
            Note we are not keeping this change so it is not important
            what it is.
           <pre>
cd ~jules/vn4.7_tutorial_bc_rosestem/
fcm st

#this returns nothing
cd rose-stem/
# edit the rose-suite.conf, change HOUSEKEEPING to false, save and close the file
fcm st
<font color=blue>M       rose-suite.conf</font>
# we have decided that we did not want to change that, so lets revert it using
# fcm.
fcm revert rose-suite.conf
fcm st

# this returns nothing as we have reverted the uncommitted change that we made
# in our local/working directory.
          </pre>
            <p>The <code>fcm revert</code> command is very helpful if you want 
               to revert, one, a few or all local changes.
               See <code>fcm revert --help</code> for more options.</p>
            <br/>
           <p>Now to make a change that we want to keep and test:</p>
           <pre>
cd ~jules/vn4.7_tutorial_bc_rosestem/
# move to the sourse directory of the JULES code
cd src/snow
# edit tridag.F90 ln 68 to be this:
  gamm(n) = c(n-1) / beta_2
# save and close the file
           </pre> 
           <h4>Test the change</h4>
           <ol>
           <li>Run rose stem</li>
           <li>Look at the appropriate logs to provide evidence of success or
               failure</li>
           <li>What three methods can you use to find the answer for 2.?</li>
           <li>Which do you prefer and why?</li>
           </ol>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseEleven">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseEleven" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
                            <font color=green>
Example failures and successes:
Fails - fcm_make_meto_linux_gfortran_omp
Fails - fcm_make_meto_linux_gfortran_debug
Fails - fcm_make_meto_xc40_cee_debug
Fails - fcm_make_meto_xc40_cee_omp
Fails - fcm_make_meto_linux_intel_debug_noomp_nompi
Fails - fcm_make_meto_linux_intel_noomp_mpi
Succeed - fcm_make_meto_xc40_cce_omp
Succeed - fcm_make_meto_xc40_cce_debug
                            </font>
                            </pre>
                            <img src="images/fail_rs.png" width="95%" id="fail1"/>
                            <p>job stderr states IMPLICIT NONE....for data object "BETA_2"</p>
                           <p>Which is the change we made.</p>
                           <p>Now revert the change using FCM</p>
                           <br/>
                          <p>The three methods are the gcylc GUI, Rose Bush and the cylc-run/ directory.</p>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
            <p>You should have reverted that change if you are following this 
               tutorial, make sure there are no local changes by using 
               <code>fcm st</code> if there are changes please revert them.</p>
            <br/>
            <p><strong>In the intermediate tutorial we will add a new variable, 
               a new module etc.</strong></p>
            <br/>
            <h3>What have we covered in Practical 3?</h3>
               <p>In this section we introduced JULES rose-stem testing, for 
                  testing the JULES code.</p>
               <p>The gcylc GUI and helpful Rose and Cylc commands.</p>
               <p>How to debug you failures using the gcylc GUI, Rose Bush or
                  the cylc-run directory.</p>
               <p>Using basic FCM commands.</p>
               <p>The basics of Trac pages and Tickets.</p>
               <p>Creating a branch, making a change then reverting it, testing
                  a change, finding the error and correcting it.</p>

        </ul>
        <br/>

        <ul>
            <div class="page-header">
                <h2><a id="P4">Practical 4 - Checkout a suite</a></h2>
            </div>
            <div class="well">
               <h3>In Practical 4 we will cover:</h3>
                  <p>Checking out a JULES-Rose suite.</p>
                  <p>JULES-Rose suite structure.</p>
                  <p>Using Rosie Go.</p>
                  <p>Explore Rose Edit.</p>
                  <p>Run the JULES-Rose suite</p>
               <br/>
               <p>In this practical we will use two different methods, command
                  line and GUI's for all of the tasks.</p>
               <p>Please try both and then chose which you prefer, but remember,
                  you can mix and match and always change your mind!</p>
               <br/>
               <h3>Check out a JULES-Rose suite</h3>
               <p>We are going to checkout the JULES-Rose suite, u-ai828.</p>
               <p>It is one from the MOSRS, the <code>u</code> refers to the
                  suite being part of the MOSRS Rosie Repository.</p>
               <p><code>ai828</code> is a unique "number" assigned by the Rosie
                  Repository to the suite.
                  The "number" is incremental, no two suites can have the 
                  same number, also you cannot choose the number.</p>
               <pre>
rosie checkout u-ai828
<font color=blue>
[INFO] u-ai828: local copy created at /USER/roses/u-ai828
</font>
</pre>
               <br/>
               <h3>JULES-Rose suite structure</h3>
               <p>The suite structure is similar for all suites.</p>
               <pre>
cd /USER/roses/u-ai828
ls
<font color=blue>
app  meta  rose-suite.conf  rose-suite.info  suite.rc
</font>
</pre>
               <p>The suite only contains plain text files, so all of the 
                  contents can be read with a text editor.</p>
               <p>The <code>app/</code> and the <code>meta</code> are 
                  directories.
                  The <code>rose-suite.conf</code>, <code>rose-suite.info</code>
                  and the <code>suite.rc</code> are text files.</p>
              <ol>
                  <li>The <code>rose-suite.info</code> file contains information
                      on the suite that is searchable in Rosie Go (see below).
                  </li>
                  <li>The <code>rose-suite.conf</code> is where you should find
                      all of the variables that you may have to change.</li>
                  <li>The <code>suite.rc</code> is the Runtime Configuration
                      file for the suite.
                      It contains the <code>graph</code> section for the running
                      order of the tasks in the suite.
                      The task names and the environment variables that they
                      need which may be from the <code>rose-suite.conf</code>.
                      Directives, Submission Methods, etc.
                      In this file there is not just Python code but Jinja2, 
                      a templating language in Python, don't worry we will
                      discuss it when we need to make changes.</li>
                    <li>The <code>app/</code> directory contains the 
                        Applications, for example <code>fcm_make</code> and the
                        <code>jules</code> app's with their 
                        <code>rose-app.conf</code> configurations files.</li>
                    <li>The <code>meta/</code> directory contains the
                        metadata for the suite, which helps you to understand
                        the values and parameters in the suite.</li>
               </ol>
               <br/>
               <p>Some suites have more directories, some contain data.</p>
               <p>There is some data in this suite, can you find it?
                  It is Loobos data.</p>

            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwelve">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseTwelve" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
                            <font color=green>
grep -ril loobos * | more
                            </font>
                            <font color=blue>
app/jules/file/Loobos_1997.dat
app/jules/rose-app.conf
rose-suite.info
                            </font>
                            <font color=green>
app/jules/file/Loobos_1997.dat
                            </font>
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
            <p>We will go into each file in detail as we interact with them
               below in the practicals.</p>
               <br/>
               <p>The command line technique is great if you know the suite ID 
                  that you wish to checkout.
                  But if you do not know or cannot remember the suite ID we
                  can look it up based on the information in the 
                  <code>rose-suite.info</code> file using Rosie Go</p>
               <h3>Rosie Go</h3>
               <p>Rosie Go is the suite browser GUI</p>
               <p>First lets check your set-up, open your
                   <code>.metomi/rose.conf</code> file, it should include 
                   similar to the following output.</p>
<pre>
<font color=blue>
[rosie-id]
prefix-username.u=MOSRS_USERNAME
prefixes-ws-default=u
</font>
</pre>
                <p>Now we can open Rosie Go by:</p>
<pre>
cd
rosie go &amp;
</pre>
               <br/>
               <img src="images/rosie_go.png" width="95%" id="rgo"/>
               <br/>
               <p>Search for all of the user "kerryday"'s suites using the 
                  search box at the top far right of the Rosie Go GUI.</p>
               <p>Hover your mouse over each of the icons on the far left of
                  the Rosie Go GUI and find out what each of the images mean.</p
>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseThirteen">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseThirteen" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
                            <font color=green>
House - Local copy
Double backwards arrow - Local copy at older revision
Notepad and pen - Local copy (modified)
                            </font>
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
               <p>You can search for anything that may be in the
                  <code>rose-suite.info</code> file and not just a user.</p>
               <p>Right click on the suite that you are interested in.</p>
               <img src="images/rosie_go2.png" width="95%" id="rgo2"/>
               <p>Note that the <code>Checkout Suite</code> option is greyed
                  out, this is because we already have a copy.
                  However if we want we can chose to 
                  <code>Delete Working Copy</code> and then 
                  <code>Checkout Suite</code> to prove it works the same as
                  command line.</p>
               <br/>
               <p>Notice we can do many other things from the Rosie Go GUI.</p>
               <p>Next we will use it to open <code>Rose Edit</code>.<p/>
               <h3>Rose Edit</h3>
               <p>There are three ways to open Rose Edit:
                  <ol>
                     <li>Command line
<pre>
cd /USER/roses/u-ai828
rose edit
</pre>
</li>
                     <li>Rosie Go GUI - double click on the suite of interest.</li>
                     <li>Rosie Go GUI - right click on the suite of interest 
                         and select <code>Edit Suite</code></li>
                    </p>
                    <img src="images/rose_edit.png" width="95%" id="red"/>
                    <br/>
                    <p>Click OK on both of the Error messages.
                       They are only warnings as the suite uses Jinja2 variables
                       from the rose-suite.conf file that Rose Edit has not
                       expanded.</p>
                    <p>Click on the different items in the <code>Index</code>
                       on the left hand side of the panel of the Rose Edit GUI.
                       What do you notice about the items in the Index?</p>
                    <br/>
                    <img src="images/rose_edit2.png" width="95%" id="red2"/>
                    <br/>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseFourteen">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseFourteen" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
                            <font color=green>
They are the same as in the command line directory.
                            </font>
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
                    <p>Do not worry if you accidently change something in this
                       suite, as you are not the owner you cannot commit your
                       change back to the repository, so take a look around.
                       More on changes and saving in Practical 5.</p>
                    <br/>
                    <p>Now we are going to run the suite.</p>
                    <br/>
               <h3>Run a JULES-Rose Suite</h3>
               <p><strong>IF USING THE VM PLEASE USE SUITE ID u-ai829</strong> 
               and change the path of to the JULES code in the 
               <code>rose-suite.conf</code> to point to your vagrant file
               location of the JULES vn4.7 code, for example, /home/vagrant/jules/vn4.7/trunk/</p>
               <p>There are three ways to run the suite:
                  <ol>
                     <li>Command line
<pre>
cd /USER/roses/u-ai828
rose suite-run
</pre>
</li>
                     <li>Rosie Go GUI - click on the suite that you want to run,
                         then click on the "Play" button in the top of the GUI,
                         its says <code>Run Suite</code> when you hover over it.
                    </li>
                    <li>Rose Edit GUI - click on the "Play" button in the top 
                        left of the GUI, its says <code>Run Suite</code> when
                         you hover over it.
                    </li>
                </ol>
              </p>
                   <p>The gcylc GUI should look like the images below.</p>
                    <img src="images/rose_suite1.png" width="95%" id="rs1"/>
                    <br/>
                    <br/>
                    <img src="images/rose_suite2.png" width="95%" id="rs2"/>
                    <br/>
                    <br/>
                    <p>The gcylc GUI clears if the suite is successful.
                    With the message <code>stopped with 'succeeded'</code></p>
                    <img src="images/rose_suite3.png" width="95%" id="rs3"/>
                    <br/>
                    <ol>
                    <li>How can you find out how long each task took to run?</li>
                    <li>How long did the fcm_make task take?</li>
                    <li>How long did the jules task take?</li>
                    </ol>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseFifteen">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseFifteen" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
                    <ol>
<li>How can you find out how long each task took to run?</li>
                            <font color=green>
Rose Bush
                            </font>
<li>How long did the fcm_make task take?</li>
                            <font color=green>
About 2 mins
                            </font>
<li>How long did the jules task take?</li>
                            <font color=green>
About 15 seconds
                            </font>
                    </ol>

                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
            <h3>Congratulations you have successfully run your first JULES-Rose Suite.</h3>
            </div>
        </ul>
        <br/>
        <ul>
            <div class="page-header">
                <h2><a id="P5">Practical 5 - Changing the Soil Ancillaries</a></h2>
            </div>
            <div class="well">
               <h3>In Practical 5 we will cover:</h3>
                  <p>Copying a JULES-Rose suite, edit the rose-suite.info.</p>
                  <p>Change the output period, output directory location etc.</p>
                  <p>Change the spinup.</p>
                  <p>Change the soil properties.</p>
                  <p>Running the suite with a different name</p>
               <br/>
                <h4>Intro and background</h4>
                  <p>This practical changes the soil ancillaries corresponding
                     to a different soil type.</p>
                <br/>
                <p>Soil ancillaries have an important effect on hydrology and
                   thermodynamics.
                   They affect sensible and latent heat fluxes that are passed
                   back to the atmosphere.
                  </p>
                  <p>The paper by <a href="http://onlinelibrary.wiley.com/doi/10.1029/WR020i006p00682/pdf">Cosby et. al. (1984)</a> defines a range of distinct soil types.
                   The relevant parameters for a few soil types are:</p>  
<pre>
Sand
'b','sathh','satcon','sm_sat','sm_crit','sm_wilt','hcap','hcon','albsoil'
3.295,0.04983,0.02455,0.3732,0.1039,0.03264,1.341E+06,0.3329,0.17
<br/>
Loam
'b','sathh','satcon','sm_sat','sm_crit','sm_wilt','hcap','hcon','albsoil'
5.797,0.2383,0.004749,0.4373,0.277,0.1434,1.225E+06,0.2491,0.17
<br/>
Clay
'b','sathh','satcon','sm_sat','sm_crit','sm_wilt','hcap','hcon','albsoil'
12.14,0.2864,0.001432,0.4523,0.3692,0.2696,1.244E+06,0.2192,0.17
</pre>
                  <br/>
                <h3>Copy u-ai828 and edit the rose-suite.info</h3>
                <p>Chose one of the following two options to create your copy
                   of the suite.</p>
                <ol>
                <li>command line?</li>
                <li>Rosie Go</li>
                </ol>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseSixteen">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseSixteen" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
                <ol>
<li>At command line?</li>
<font color=green>rosie copy u-ai828
# This open the rose-suite.info file in a text editor, change the description 
# to include the soil type you will change.</font>
<li>Via Rosie Go</li>
<font color=green>rosie go &amp;
# search u-ai828
# right click, select copy, select FORWARD, change the description to include
# the soil type you will change, click OK.</font>
                </ol>
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>

                  <h4>Hints and Tips for using Rose Edit for making changes</h4>
                  <ul>
                 <li>The gear-wheel icon near the variable name is clickable, with several useful functions, including taking you to the documentation.</li>
                  <li>If you can't see the variable you want, try right-clicking to add latent variable.</li>
                  </li>To alter the soil ancillaries, you can enter the data into the Rose Edit GUI manually.</li>
                  </ul>
                  <p>The following instructions are for changes at command line,
                     but will also help with changes in the Rose Edit GUI.</p>
                  <h3>Change the output period, output directory location etc.</h3>
                  <ol>
                  <li>Change the output period to be daily (86400 seconds).
                  <p>In the <code>app/jules/rose-app.conf</code> file change</p> 
<pre>
[namelist:jules_output_profile(1)]
output_period=86400
</pre>
</li>
                  <li>Ensure that gridbox mean sensible heat flux, latent heat flux and surface temperature are output.
                  <p<a href="http://jules-lsm.github.io/vn4.7/output-variables.html">JULES Output variables</a></p>
<pre>
ftl_gb 	Gridbox surface sensible heat flux (W m-2)
latent_heat 	Gridbox surface latent heat flux (W m-2)
tstar_gb 	Gridbox surface temperature (K)
</pre>
<p>Check these variables are present in the <code>app/jules/rose-app.conf</code>
 file in the <code>[namelist:jules_output_profile(1)]</code> section and if 
not add them.</p>

</li>
                  <li>Change the output directory name, create the relevant directory, change the run ID.
                  <p> In the <code>app/jules/rose-app.conf</code> file change
<pre>
[file:./sand/output]
mode=mkdir
source=

[namelist:jules_output]
output_dir='./sand/output'
run_id='sand'
</pre>
</li>
</ol>
                  <h3>Change the spinup.</h3>
                  <p>In the <code>app/jules/rose-app.conf</code> file change</p 
<pre>
[namelist:jules_spinup]
max_spinup_cycles=10
nvars=1
spinup_end='1977-12-31 23:00:00'
spinup_start='1996-12-31 23:00:00'
terminate_on_spinup_fail=.false.
tolerance=5.0
use_percent=.true.
var='smcl'
</pre>
                  <h3>Change the soil properties.</h3>
                  <p>In the <code>app/jules/rose-app.conf</code> file change</p> 
<pre>
[namelist:jules_soil_props]
const_val=3.295,0.04983,0.02455,0.3732,0.1039,0.03264,1341000.0,
         =0.3329,0.17
</pre>
                  <p>Open the Rose Edit GUI after you have made your changes to so that the metadata checks for mistakes.</p>

                  <strong>COMMIT your changes</strong> using <code>fcm ci</code>

                  <h3>Running the suite with a different name to the suite ID.</h3>
<pre>
rose suite-run --new --name=sand_&lt;SUITE_ID&gt;
</pre>
                 <p>Check your output at:</p>
<code>/USER/cylc-run/sand_&lt;SUITE_ID&gt;/work/1/jules/sand/output/</code>
<br/>
                 <h3>Creating the other soil suites</h3>
                 <p>We have several options now.</p>
                 <ol>
                 <li>Copy your recent suite, &lt;SUITE_ID&gt; using 
                    <code>rosie copy &lt;SUITE_ID&gt;</code> and get a new suite
                    and new suite ID for you changes and commit it. </li>
                 <li>Create a branch from the current suite and the use 
                     <code>fcm sw &lt;BRANCH_NAME&gt;</code>, remember to 
                     commit your changes and to check where you are with
                     <code>fcm info</code>.
                     <br/>
                     <p>Run your new soil type using:
<pre>
rose suite-run --new --name=&lt;SOIL_TYPE&gt;_&lt;SUITE_ID&gt;
</pre>
</p>
                     <br/>
                     To switch back to the original use <code>fcm sw trunk</code>
                     you can check your branch names using <code>fcm bls</code></li>
                 </ol>
                 <br/>
                 <p>The first is the simplest, but I personally prefer the
                    second as it groups them suites together.</p>
                 <br/>
                 <p>An examples of how the Rosie Repository Trac pages look follow:</p>
                 <a href="https://code.metoffice.gov.uk/trac/roses-u/browser/a/i/8/2/8">u-ai828</a>
<br/>
                    <img src="images/rosie_trac1.png" width="70%" id="rrt1"/>
                    <p>Select sand_prac5</p>
                    <img src="images/rosie_trac2.png" width="75%" id="rrt2"/>
                    <p>Click on the "Revision Log"</p>
                    <img src="images/rosie_trac3.png" width="75%" id="rrt3"/>
                    <p>Click on "View Changes" and then View Differences "side by side" and update</p>
                    <img src="images/rosie_trac4.png" width="95%" id="rrt4"/>

                 <h3>Questions</h3>
                 <ol>
                 <li>What effect do the different soil types have on the model
                     fluxes and the model state?</li>
                 <li>Is there any seasonal variation in the results?
                     Is this what you expected?</li>
                 <li>How important is getting the right soil type for the
                     evolution of the model?</li>
                 </ol>
            <br/>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseSeventeen">
                        <span class="glyphicon"></span>
                        Note
                        </a>
                    </h4>
                </div>
                <div id="collapseSeventeen" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
<p> Note: The differences may only be small between the output for the different
suite set-ups.
<br/>
When plotting the differences the small difference may not be observable by eye 
with some plotting packages.
For example it has been noted that ncview does not appear to display differences
clearly by eye but MatLab and Iris display the difference.</p>
<p><a href="http://scitools.org.uk/iris/">Iris</a> is an open-source Python library for Meteorology and Climatology.</p>
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
            </div>
        </ul>
        <br/>
        <ul>
            <div class="page-header">
                <h2><a id="P6">Practical 6 - Changing Canopy Radiation Model and Plotting</a></h2>
            </div>
            <div class="well">
               <h3>In Practical 6 we will cover:</h3>
                  <p>Changing canopy the radiation model configurations</p>
                  <p>Changing the JULES-Rose suite design to run JULES for multiple configurations</p>
                  <p>Add optional configurations files to the JULES-Rose suite</p>
                  <p>Run the suite</p>
                  <p>Questions</p>
                  <p>Adding plots</p>
               <br/>
               <p>
               In Practical 5 we copied the suite three times, sand, loam and clay.
               Each had its own suite id and we ran each suite to get the results.
               However, this is not the most effect way of running the suite to
               get the data as each time it run the <code>fcm_make</code> task.
              </p>
              <br/>
              <p>This time we want to run the suite for six different model configurations.
                 Each is only a one line change, it would be a waste of resource
                 to have six different suites and run each so we will used the 
                 functionality of Rose to make this more efficient.
            </p>
            <p>Cylc/Rose will schedule the jules tasks to run simultaneously
               which will reduce the running time of your suite.</p>
            <h3>Changing canopy the radiation model configurations</h3>
               <p>Information on the options in JULES for calculating the effect
                  of the vegetation canopy on radiation is in the <a href="http://jules-lsm.github.io/vn4.7/namelists/jules_vegetation.nml.html#JULES_VEGETATION::can_rad_mod">documentation.</a></p>
              In summary, in the <code>jules</code> application configuration
              file <code>SUITE_ID/app/jules/rose-app.conf</code> the namelist 
              <code>jules_vegetation</code> has an option <code>can_rad_mod</code>.
              </p>
              <p>
              What is the default set to in <code>u-ai828/u-ai829</code>? 
              What two ways can you find the value?
              </p>

            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseEighteen">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseEighteen" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
                            <font color=green>
[namelist:jules_vegetation]
can_rad_mod=4

command line, view the file u-ai828/app/jules/rose-app.conf
rose edit -&gt; jules &gt; namelist &gt; jules_vegetation <code>can_rad_mod</code>
                            </font>
<img src="images/rose_edit_rad.png" width="95%" id="rer"/>
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
            <h3>Changing the JULES-Rose suite design to run JULES for multiple configurations</h3>
            <p>To change the suite design we have to edit the text files in the
               suite using a text editor.</p>
            <p>First we must either copy <code>u-ai828/u-ai829</code> or create
               a branch of <code>u-ai828/u-ai829</code> and then switch to it.
            </p>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseNinteen">
                        <span class="glyphicon"></span>
                        Methods
                        </a>
                    </h4>
                </div>
                <div id="collapseNinteen" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
rosie copy u-ai828

OR (my preferred method, but it is a personal preference)

cd /USER/roses/u-ai828
fcm bc canranmod
fcm sw canranmod
#or fcm sw https://code.metoffice.gov.uk/svn/roses-u/a/i/8/2/8/canradmod
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
            <p>Now we can make changes to the suite.</p>
            <p>
            <ol>
            <li>We need to edit the <code>rose-suite.conf</code> file to 
                include a list of the different radiation models.
                For Example 
<pre>
CANRADMOD=['canradmod_1', 'canradmod_2', 'canradmod_3', 'canradmod_4', 'canradmod_5', 'canradmod_6']
</pre></li>
            <li>We need to change the <code>graph</code> section in the
                <code>suite.rc</code> to loop through the list in the
                <code>rose-suite.conf</code>. For Example
<pre>
        graph = """
                {% for crm in CANRADMOD %}
                    fcm_make => jules_{{crm}}
                {% endfor %}
                """
</pre>
            This looks like Python but is actually Jinja2, more on this in
            the Intermediate tutorial.</li>
            <li>We need to change the <code>jules</code> task in the
                <code>suite.rc</code> to loop through the list in the
                <code>rose-suite.conf</code> and for it to use the optional
                configuration file with the two line change. For Example
<pre>
{% for crm in CANRADMOD %}
    [[jules_{{crm}}]]
        inherit = None, SPICE
        script = "mkdir -p output ; rose task-run --path= --path=share/fcm_make/build/bin --app-key=jules --opt-conf-key={{crm}}"
 ...    
 ...        --ntasks={{ OMP_NUM_THREADS * MPI_NUM_TASKS}}
{% endfor %}
</pre>
            The optional configuration file is selected by the suite using the
            <code>--opt-conf-key={{crm}}</code> syntax/code, also Jinja2.</li>
            <h3>Add optional configurations files to the JULES-Rose suite</h3>
            <li>We need to add an <code>opt</code> folder to the jules app.</li>
            <li>We need to populate the <code>SUITE_ID/app/jules/opt/</code>
                with the 6 different <code>rose-app-???.conf</code> files.
                For Example <code>rose-app-canradmod_1.conf</code>
<br/>
<br/>
<pre>
[namelist:jules_vegetation]
can_rad_mod=1
</pre>
              </li>
              </ol>
              </p>
              <p>We need to save our changes before running the suite.</p>
              <p>How can we check what our changes are and then commit them to
                 the repository?</p>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwenty">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseTwenty" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
                            <font color=green>
fcm st
                            </font>
                            <font color=blue>
?       app/jules/opt
M       rose-suite.conf
M       suite.rc
                            </font>
                            <font color=green>
fcm add app/jules/opt
                            </font>
                            <font color=blue>
A         app/jules/opt
A         app/jules/opt/rose-app-canradmod_1.conf
A         app/jules/opt/rose-app-canradmod_2.conf
A         app/jules/opt/rose-app-canradmod_3.conf
A         app/jules/opt/rose-app-canradmod_4.conf
A         app/jules/opt/rose-app-canradmod_5.conf
A         app/jules/opt/rose-app-canradmod_6.conf
                            </font>
                            <font color=green>
fcm st
                            </font>
                            <font color=blue>
A       app/jules/opt
A       app/jules/opt/rose-app-canradmod_1.conf
A       app/jules/opt/rose-app-canradmod_2.conf
A       app/jules/opt/rose-app-canradmod_3.conf
A       app/jules/opt/rose-app-canradmod_4.conf
A       app/jules/opt/rose-app-canradmod_5.conf
A       app/jules/opt/rose-app-canradmod_6.conf
M       rose-suite.conf
M       suite.rc
                            </font>
                            <font color=green>
fcm ci
# Add your commit message, save, close and "y" to commit
                            </font>
                            <font color=blue>
[info] vim: starting commit message editor...
Change summary:
--------------------------------------------------------------------------------
[Root   : https://code.metoffice.gov.uk/svn/roses-u]
[Project: a/i/8/2/8]
[Branch : rad_models_prac6]
[Sub-dir: ]

A       app/jules/opt
A       app/jules/opt/rose-app-canradmod_1.conf
A       app/jules/opt/rose-app-canradmod_2.conf
A       app/jules/opt/rose-app-canradmod_3.conf
A       app/jules/opt/rose-app-canradmod_4.conf
A       app/jules/opt/rose-app-canradmod_5.conf
A       app/jules/opt/rose-app-canradmod_6.conf
M       rose-suite.conf
M       suite.rc
--------------------------------------------------------------------------------
Commit message is as follows:
--------------------------------------------------------------------------------
Added looping for canradmod's.
--------------------------------------------------------------------------------
Would you like to commit this change?
Enter "y" or "n" (or just press <return> for "n"): y
Adding         app/jules/opt
Adding         app/jules/opt/rose-app-canradmod_1.conf
Adding         app/jules/opt/rose-app-canradmod_2.conf
Adding         app/jules/opt/rose-app-canradmod_3.conf
Adding         app/jules/opt/rose-app-canradmod_4.conf
Adding         app/jules/opt/rose-app-canradmod_5.conf
Adding         app/jules/opt/rose-app-canradmod_6.conf
Sending        rose-suite.conf
Sending        suite.rc
Transmitting file data ........
Committed revision 28232.
Updating '.':
At revision 28232
                            </font>
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
            <h3>Run the suite</h3>
            <code>rose suite-run --name=canradmod6 --new</code>
            <img src="images/canradmod_p6.png" width="95%" id="rs_p6"/>
            <br/>
            <h3>Questions</h3>
            <ol>
              <li>Where is the output for each of the jules canradmod setting?</li>
              <li>What was the effect of changing canradmod?</li>
              <li>How useful was this approach of changing model settings? 
                  What types of experiments would it be useful for?</li>
              <li>Look at the changes via <code>rose edit</code> what is different?</li>
            </ol>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwentyOne">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseTwentyOne" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
            <ol>
<li>Where is the output for each of the jules canradmod setting?</li>
<font color=green>
ls ~/cylc-run/canradmod_p6/work/1/jules_canradmod_1/output
jules_canradmod_1.all.nc
jules_canradmod_1.dump.19961231.82800.nc
jules_canradmod_1.dump.19970101.0.nc
jules_canradmod_1.dump.19971231.82800.nc
</font>     
<li>What was the effect of changing canradmod?</li>
<font color=green>
Changed the Gridbox total soil moisture in column.
</font>
<li>How useful was this approach of changing model settings? 
What types of experiments would it be useful for?</li>
<font color=green>
Faster runs, multi-option runs including times as well as variables, lots.
</font>
 <li>Look at the changes via <code>rose edit</code> what is different?</li>
<img src="images/rose_edit_rad2.png" width="95%" id="rer"/>
<font color=green>
A pad of paper and a hand with a pointing finger on the paper are next to the 
can_rad_mod option in the namelist.
This means that there are optional configurations, if you click on the icon
it displays the optional configurations, note there is none for canradmod_4 as
it is the same as the default option.
</font>
            </ol>
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>


            <h3>Adding plots</h3>
            <p>You may want to do some plotting of the data and you can add this
               to be part of your suite.</p>
            <p>Here we will see how to do this using a Python Iris script.</p>
<pre>
# switch to the trunk
fcm sw trunk
# Create a new branch for the plotting suite
fcm bc canradmod_plots
# switch to the new plotting branch
fcm sw canradmod_plots
# merge in the canradmod branch ready for the plotting
fcm merge canradmod
# commit the changes
fcm ci
# now we can add the plotting.
</pre>
            <h4>Changes that need to be made are:</h4>
            <ol>
            <li>suite.rc, graphing, task added, Family added</li>
            <li>Add bin/ directory with Python script, make sure it is executable</li>
            </ol>
            <p>Below is the Python script that was written to run with the 
               suite.</p>
<pre>
#!/usr/bin/env python2.7

'''
Script plot_crm.py to plot the 6 different canopy radiation model options.
Created by Kerry Smout-Day 28/12/2016
'''

import matplotlib as mlp

mlp.use('Agg')

import iris
import iris.quickplot as qplt

import matplotlib.pyplot as plt

import argparse
import os

iris.FUTURE.netcdf_promote=True


curr_var=["Gridbox surface latent heat flux", "Gridbox surface sensible heat flux", "Gridbox total soil moisture in column", "Gridbox surface temperature", "Gridbox soil moisture availability factor (beta)"]

filename=["latent_heat_flux_tseries.png", "sensible_heat_flux_tseries.png", "tot_soil_moisture_tseries.png", "surface_temperature_tseries.png", "soil_moisture_availability_factor_tseries.png"]


def load_and_squeeze(filename):
    """Loads files into iris cubelists and removes singleton dimensions"""
    clist          = iris.load(filename)
    squeezed_clist = iris.cube.CubeList()
    for cube in clist:
      squeezed_clist.append(iris.util.squeeze(cube))
    return squeezed_clist


def data_retrieve():
    """Adds the data to a dictionary for handling and plotting."""
    suite_path = os.path.expanduser('~/cylc-run/')
    files = {}
    for crm in CANRADMOD:
        filecalled = "jules_" + crm + ".all.nc"
        foldername = "work/1/jules_" + crm
        file_path = os.path.join(suite_path, CYLC_SUITE_NAME, foldername, "output/", filecalled)
        files[crm] = load_and_squeeze(file_path)
    plot_data(files, curr_var, filename)


def plot_data(files, curr_var, filename):
    """Plots and saves the data."""
    x=0
    for var in curr_var:
        for crm in CANRADMOD:
            qplt.plot((files[crm]).extract(var)[0], label = crm)
        plt.legend()
        savefile = filename[x]
        plt.savefig(savefile)
        x += 1
        plt.close()


if __name__ == '__main__':
    """Takes the arguments from the suite for us in the analysis."""
    # Initialise the command line parser
    parser = argparse.ArgumentParser()
    parser.add_argument('--suite', help='suite name', required=True)
    # canradmod is a list of strings of 1 or more arguments.
    parser.add_argument('--canradmod', nargs='+', type=str, help='different models', required=True)
#
    #Parser the command line.
    args = parser.parse_args()
    CYLC_SUITE_NAME = args.suite
    CANRADMOD = args.canradmod

    data_retrieve()
</pre>
                    <p>Other changes have been made to the following files:</p>
                <ol>
                <li><code>rose-suite.conf</code></li>
<img src="images/prac6_trac1.png" width="95%" id="p6_tp1"/>
                 <p>Here CANRADMOD" has been added so that the list in the correct format for the Python plotting.</p>
                <li><code>suite.rc</code></li>
<img src="images/prac6_trac2.png" width="95%" id="p6_t2"/>
                <p>Here the family <code>[[JULES]]</code> has been added and
                  then used in the <code>graph</code> section for the
                  dependency of the <code>jules</code> tasks must all 
                  succeed before the plotting task <code>plot_crm</code> can
                  run.
                  All <code>jules</code> task now inherit the <code>JULES</code>
                  family for this to happen.
                  A new task of <code>[[plot_crm]]</code> has been added, it                      runs the script <code>plot_crm.py</code> with the arguments
                  <code>CYLC_SUITE_NAME</code> a variable assigned at run time,                   it will use the optional name if provided and 
                  <code>CANRADMOD2</code>, the list of models in the required
                 format.</p>
                </ol>
                <p>The <a href="https://code.metoffice.gov.uk/trac/roses-u/changeset?reponame=&new=28241%40a%2Fi%2F8%2F2%2F8%2Frad_model_prac6_plot&old=28234%40a%2Fi%2F8%2F2%2F8%2Frad_model_prac6_plot">revision Log of the changes</a> after adding the different models is provided in the link.</p>
                <br/>
                <h4>Some new things from running this suite in the gcylc GUI</h4>
                <p>The image below shows two <code>Views</code> the "Graph" view
                   in the top section of the gcylc GUI, View 1, and the "Text"
                   view in the bottom section as View 2.</p>
                <p>One other thing to notice in the Graph View is that the JULES
                   family is grouped together, to un-group it select the second
                   button after the Views button to expand the family.</p>
<img src="images/prac6_plots2.png" width="85%" id="p6_p1"/>
                 <br/>
                 <br/>
                <p>The image below show the JULES family expanded.
                   We can see all of the dependencies clearly. </p>
<img src="images/prac6_plots1.png" width="85%" id="p6_p2"/>
                 <br/>
                 <br/>
                 <p>In the image below, what are the states of each task?<p>
<img src="images/prac6_plots3.png" width="85%" id="p6_p3"/>
                 <br/>
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwentyTwo">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseTwentyTwo" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
                            <font color=green>
fcm_make - succeeded
jules_canradmod_1/2/3/5/6 - running
jules_canradmod_4 - submitted
plot_crm - waiting
                            </font>
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>

            <br/>
            <h3>
            Now try to create the suite and run the suite.
            </h3>
            Where are the plots that are created? (Clue where the output is.)
            <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwentyThree">
                        <span class="glyphicon"></span>
                        Answers
                        </a>
                    </h4>
                </div>
                <div id="collapseTwentyThree" class="panel-collapse collapse">
                   <div class="panel-body">
                        <div class="row">
                            <pre>
                            <font color=green>
/USER/cylc-run/practical6_test2/work/1/plot_crm/
latent_heat_flux_tseries.png                   surface_temperature_tseries.png
sensible_heat_flux_tseries.png                 tot_soil_moisture_tseries.png
soil_moisture_availability_factor_tseries.png
</font>
<img src="images/latent_heat_flux_tseries.png" width="95%" id="p6_lh"/>
<img src="images/sensible_heat_flux_tseries.png" width="95%" id="p6_sh"/>
<img src="images/soil_moisture_availability_factor_tseries.png" width="95%" id="p6_sm"/>
<img src="images/surface_temperature_tseries.png" width="95%" id="p6_st"/>
<img src="images/tot_soil_moisture_tseries.png" width="95%" id="p6_tsm"/>


                            </pre>
                        </div>
                    </div>
                </div>
            </div>
            <br/>

            <h3>Congratulations you have completed the Beginners Tutorial!</h3>

            </div>
        </ul>

       </div>

        <br/>
        <div class="container">
        <div class="well">
        Now lets do the Intermediate Quiz to see how much you already know and what we
        will need to focus on in the next section.
        Don't worry if you don't know all the answers yet, we will learning more in the next tutorial.
        </div>
        <p><a class="btn btn-lg btn-success" href="intermediate_quiz.html" role="button">Intermediate Quiz</a></p>
        </div>
        <br/>
        <div class="container">
        </div>
        <hr/>
        <div class="container-fluid text-center">
        <div class="row">
        <div class="col-md-12">
        <address><small>
        &copy; British Crown Copyright 2006-17
        <a href="http://www.metoffice.gov.uk">Met Office</a>.<br />
        This document is released under the British <a href=
            "http://www.nationalarchives.gov.uk/doc/open-government-licence/" rel=
            "license">Open Government Licence</a>.<br />
        </small>
        </address>
        </div>
        </div>
        </div>
        <!-- Bootstrap core JavaScript
            ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="./js/vendor/jquery.min.js"><\/script>')</script>
        <script src="../etc/bootstrap/js/bootstrap.min.js"></script>
        <script src="./js/docs.min.js"></script>
        <script LANGUAGE="JavaScript">
            update = new Date(document.lastModified);
            theMonth = update.getMonth() + 1;
            theDate = update.getDate();
            theYear = update.getFullYear();
            theHour = update.getHours();
            theMin = update.getMinutes();
            theSec = update.getSeconds();
            document.write("<strong> Last Modified:</strong> " + theYear + "-" + theMonth + "-" + theDate + "T" + theHour + ":" + theMin + ":" + theSec + "Z");
                
        </script>
        </div>
    </body>
</html>

